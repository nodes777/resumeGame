!function(){function a(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}function b(a,b,c){return Math.max(b,Math.min(c,a))}function c(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(c)},c.open("GET",a,!0),c.send()}function d(a,b,c,d,e,f,g,h){return!(a+c-1<e||e+g-1<a||b+d-1<f||f+h-1<b)}function J(a,b){this.x=a,this.y=b,this.x_speed=Math.floor(10*Math.random()+1),this.y_speed=Math.floor(10*Math.random()+1),this.radius=5}function K(){for(var a=0;a<E.length;a++)E[a].render()}function L(){for(var a=0;a<E.length;a++)E[a].x+=E[a].x_speed,E[a].y+=E[a].y_speed,(E[a].x>v||E[a].y>w)&&E.splice(a,1)}function M(){if(E.length<100){var a=new J(100,200);E.push(a)}}function N(a,b,c){switch(b){case q.LEFT:return x.left=c,a.preventDefault(),!1;case q.RIGHT:return x.right=c,a.preventDefault(),!1;case q.SPACE:return x.jump=c,a.preventDefault(),!1}}function O(a){P(a),L()}function P(a){Q(x,a)}function Q(a,c){var e=a.dx<0,g=a.dx>0,h=a.falling,i=a.friction*(h?.5:1),j=a.accel*(h?.5:1);a.ddx=0,a.ddy=a.gravity,a.left?a.ddx=a.ddx-j:e&&(a.ddx=a.ddx+i),a.right?a.ddx=a.ddx+j:g&&(a.ddx=a.ddx-i),!a.jump||a.jumping||h||(a.ddy=a.ddy-a.impulse,a.jumping=!0),a.x=a.x+c*a.dx,a.y=a.y+c*a.dy,a.dx=b(a.dx+c*a.ddx,-a.maxdx,a.maxdx),a.dy=b(a.dy+c*a.ddy,-a.maxdy,a.maxdy),(e&&a.dx>0||g&&a.dx<0)&&(a.dx=0);var k=B(a.x),l=B(a.y),m=a.x%f,o=a.y%f,p=D(k,l),q=D(k+1,l),r=D(k,l+1),s=D(k+1,l+1);for(a.dy>0?(r&&!p||s&&!q&&m)&&(a.y=A(l),a.dy=0,a.falling=!1,a.jumping=!1,o=0):a.dy<0&&(p&&!r||q&&!s&&m)&&(a.y=A(l+1),a.dy=0,p=r,q=s,o=0),a.dx>0?(q&&!p||s&&!r&&o)&&(a.x=A(k),a.dx=0):a.dx<0&&(p&&!q||r&&!s&&o)&&(a.x=A(k+1),a.dx=0),a.falling=!(r||m&&s),n=0;n<y.length;n++)d(a.x,a.y,f,f,y[n].start.x,y[n].start.y,y[n].width,y[n].height)&&($("#"+y[n].id).fadeIn("slow"),4==n&&M()),d(a.x,a.y,f,f,y[n].start.x,y[n].start.y,y[n].width,y[n].height)||0!=y[n].clicked||$("#"+y[n].id).fadeOut("slow"),d(a.x,a.y,f,f,y[n].start.x,y[n].start.y,y[n].width,y[n].height)||1!=y[n].clicked||$("#"+y[n].id).fadeIn("slow")}function R(a,b,c){a.clearRect(0,0,v,w),S(a),U(y),T(a,c),K()}function S(a){var b,c,d;for(c=0;c<e.th;c++)for(b=0;b<e.tw;b++)d=D(b,c),d&&(a.fillStyle=p[d-1],a.fillRect(b*f,c*f,f,f))}function T(a,b){a.fillStyle=o.BLUE,a.fillRect(x.x+x.dx*b,x.y+x.dy*b,f,f)}function U(a){for(n=0;n<a.length;n++)u.font="40px Titillium Web",u.fillStyle=o.YELLOW,u.fillText(a[n].display,a[n].start.x,a[n].start.y+a[n].height-20)}function X(a){var d,e,f,b=a.layers[0].data,c=a.layers[1].objects;for(d=0;d<c.length;d++)switch(e=c[d],f=Y(e),e.type){case"player":x=f;break;case"platform":y.push(f)}z=b;for(var g=4,h=3.2,i=2048/768,j=2048/896,k=2,l=0;l<y.length;l++)4!==l?V<=839||W<=529?(y[l].clickX=y[l].x/g,y[l].clickY=y[l].y/g,y[l].clickWidth=y[l].width/g,y[l].clickHeight=y[l].height/g):V<=967||W<=625?(y[l].clickX=y[l].x/h,y[l].clickY=y[l].y/h,y[l].clickWidth=y[l].width/h,y[l].clickHeight=y[l].height/h):V<=1095||W<=721?(y[l].clickX=y[l].x/i,y[l].clickY=y[l].y/i,y[l].clickWidth=y[l].width/i,y[l].clickHeight=y[l].height/i):V<=1223||W<=817?(y[l].clickX=y[l].x/j,y[l].clickY=y[l].y/j,y[l].clickWidth=y[l].width/j,y[l].clickHeight=y[l].height/j):(V>1223||W>817)&&(y[l].clickX=y[l].x/k,y[l].clickY=y[l].y/k,y[l].clickWidth=y[l].width/k,y[l].clickHeight=y[l].height/k):(y[l].clickX=null,y[l].clickY=null,y[l].clickWidth=null,y[l].clickHeight=null)}function Y(a){var b={};return b.name=a.name.charAt(0).toUpperCase()+a.name.slice(1),b.display=a.properties.display,b.id=a.properties.id,b.clicked=!1,b.x=a.x,b.y=a.y,b.width=a.width,b.height=a.height,b.dx=0,b.dy=0,b.gravity=g*(a.properties.gravity||h),b.maxdx=g*(a.properties.maxdx||i),b.maxdy=g*(a.properties.maxdy||j),b.impulse=g*(a.properties.impulse||m),b.accel=b.maxdx/(a.properties.accel||k),b.friction=b.maxdx/(a.properties.friction||l),b.player="player"==a.type,b.left=a.properties.left,b.right=a.properties.right,b.start={x:a.x,y:a.y},b}function da(){for(ca.tickStart(),aa=a(),_+=Math.min(1,(aa-ba)/1e3);_>s;)_-=s,O(s);R(u,Z,_),ba=aa,Z++,ca.tick(),requestAnimationFrame(da,t)}window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)});var e={tw:64,th:48},f=32,g=f,h=9.8*6,i=15,j=60,k=.5,l=1/6,m=1500,o={BLACK:"#111111",YELLOW:"#fffd98",GREEN:"#40a000",LIGHTGREEN:"#80e000",BROWN:"#c06000",DARKBROWN:"#602000",BLUE:"#0006FF",GOLD:"gold"},p=[o.YELLOW,o.GREEN,o.BLACK,o.BROWN,o.DARKBROWN],q={SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},r=60,s=1/r,t=document.getElementById("canvas"),u=t.getContext("2d"),v=t.width=e.tw*f,w=t.height=e.th*f,x={},y=[],z=[],A=function(a){return a*f},B=function(a){return Math.floor(a/f)},D=function(a,b){return z[a+b*e.tw]},E=[],F={},G=$("#canvas").offset(),H=G.top,I=G.left;t.addEventListener("click",function(a){var b=a.pageX-I,c=a.pageY-H;F.x=b,F.y=c;for(var d=4,e=0;e<y.length;e++)F.y>y[e].clickY&&F.y<y[e].clickY+y[e].clickHeight&&F.x>y[e].clickX&&F.x<y[e].clickX+y[e].clickWidth?($("#"+y[e].id).fadeIn("slow"),y[e].clicked=!0,y[d].clicked=!1,d=e):($("#"+y[e].id).fadeOut("slow"),y[e].clicked=!1)}),J.prototype.render=function(){u.beginPath(),u.arc(this.x,this.y,this.radius,2*Math.PI,!1),u.fillStyle="white",u.fill()};var V=window.innerWidth,W=window.innerHeight;console.log("screen width: "+V+" screen height: "+W);var aa,Z=0,_=0,ba=a(),ca=new FPSMeter({decimals:0,graph:!0,theme:"dark",left:"5px"});document.addEventListener("keydown",function(a){return N(a,a.keyCode,!0)},!1),document.addEventListener("keyup",function(a){return N(a,a.keyCode,!1)},!1),c("js/taylorMap.json",function(a){X(JSON.parse(a.responseText)),da()})}();