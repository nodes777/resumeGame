!function(){function a(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}function b(a,b,c){return Math.max(b,Math.min(c,a))}function c(a,b){var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&200==c.status&&b(c)},c.open("GET",a,!0),c.send()}function d(a,b,c,d,e,f,g,h){return!(a+c-1<e||e+g-1<a||b+d-1<f||f+h-1<b)}function G(a,b,c){switch(b){case q.LEFT:return x.left=c,a.preventDefault(),!1;case q.RIGHT:return x.right=c,a.preventDefault(),!1;case q.SPACE:return x.jump=c,a.preventDefault(),!1}}function H(a){I(a)}function I(a){J(x,a)}function J(a,c){var e=a.dx<0,g=a.dx>0,h=a.falling,i=a.friction*(h?.5:1),j=a.accel*(h?.5:1);a.ddx=0,a.ddy=a.gravity,a.left?a.ddx=a.ddx-j:e&&(a.ddx=a.ddx+i),a.right?a.ddx=a.ddx+j:g&&(a.ddx=a.ddx-i),!a.jump||a.jumping||h||(a.ddy=a.ddy-a.impulse,a.jumping=!0),a.x=a.x+c*a.dx,a.y=a.y+c*a.dy,a.dx=b(a.dx+c*a.ddx,-a.maxdx,a.maxdx),a.dy=b(a.dy+c*a.ddy,-a.maxdy,a.maxdy),(e&&a.dx>0||g&&a.dx<0)&&(a.dx=0);var k=C(a.x),l=C(a.y),m=a.x%f,o=a.y%f,p=E(k,l),q=E(k+1,l),r=E(k,l+1),s=E(k+1,l+1);for(a.dy>0?(r&&!p||s&&!q&&m)&&(a.y=B(l),a.dy=0,a.falling=!1,a.jumping=!1,o=0):a.dy<0&&(p&&!r||q&&!s&&m)&&(a.y=B(l+1),a.dy=0,p=r,q=s,o=0),a.dx>0?(q&&!p||s&&!r&&o)&&(a.x=B(k),a.dx=0):a.dx<0&&(p&&!q||r&&!s&&o)&&(a.x=B(k+1),a.dx=0),a.falling=!(r||m&&s),n=0;n<y.length;n++)d(a.x,a.y,f,f,y[n].start.x,y[n].start.y,y[n].width,y[n].height)&&$("#"+y[n].id).fadeIn("slow"),d(a.x,a.y,f,f,y[n].start.x,y[n].start.y,y[n].width,y[n].height)||0!=y[n].clicked||$("#"+y[n].id).fadeOut("slow"),d(a.x,a.y,f,f,y[n].start.x,y[n].start.y,y[n].width,y[n].height)||1!=y[n].clicked||$("#"+y[n].id).fadeIn("slow")}function K(a,b,c){a.clearRect(0,0,v,w),L(a),N(y),M(a,c)}function L(a){var b,c,d;for(c=0;c<e.th;c++)for(b=0;b<e.tw;b++)d=E(b,c),d&&(a.fillStyle=p[d-1],a.fillRect(b*f,c*f,f,f))}function M(a,b){a.fillStyle=o.BLUE,a.fillRect(x.x+x.dx*b,x.y+x.dy*b,f,f)}function N(a){for(n=0;n<a.length;n++)u.font="40px Titillium Web",u.fillStyle=o.YELLOW,u.fillText(a[n].display,a[n].start.x,a[n].start.y+a[n].height-20)}function O(a){var d,e,f,b=a.layers[0].data,c=a.layers[1].objects;for(d=0;d<c.length;d++)switch(e=c[d],f=P(e),e.type){case"player":x=f;break;case"platform":y.push(f);break;case"treasure":z.push(f)}A=b;for(var g=0;g<y.length;g++)y[g].clickX=y[g].x/(2048/768),y[g].clickY=y[g].y/(1536/576),y[g].clickWidth=y[g].width/(1536/576),y[g].clickHeight=y[g].height/(1536/576);console.log(y)}function P(a){var b={};return b.name=a.name.charAt(0).toUpperCase()+a.name.slice(1),b.display=a.properties.display,b.id=a.properties.id,b.clicked=!1,b.x=a.x,b.y=a.y,b.width=a.width,b.height=a.height,b.dx=0,b.dy=0,b.gravity=g*(a.properties.gravity||h),b.maxdx=g*(a.properties.maxdx||i),b.maxdy=g*(a.properties.maxdy||j),b.impulse=g*(a.properties.impulse||m),b.accel=b.maxdx/(a.properties.accel||k),b.friction=b.maxdx/(a.properties.friction||l),b.player="player"==a.type,b.left=a.properties.left,b.right=a.properties.right,b.start={x:a.x,y:a.y},b}function V(){for(U.tickStart(),S=a(),R+=Math.min(1,(S-T)/1e3);R>s;)R-=s,H(s);K(u,Q,R),T=S,Q++,U.tick(),requestAnimationFrame(V,t)}window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)});var e={tw:64,th:48},f=32,g=f,h=9.8*6,i=15,j=60,k=.5,l=1/6,m=1500,o={BLACK:"#000000",YELLOW:"#fffd98",GREEN:"#40a000",LIGHTGREEN:"#80e000",BROWN:"#c06000",DARKBROWN:"#602000",BLUE:"#0006FF",GOLD:"gold"},p=[o.YELLOW,o.GREEN,o.LIGHTGREEN,o.BROWN,o.DARKBROWN],q={SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40},r=60,s=1/r,t=document.getElementById("canvas"),u=t.getContext("2d"),v=t.width=e.tw*f,w=t.height=e.th*f,x={},y=[],z=[],A=[],B=function(a){return a*f},C=function(a){return Math.floor(a/f)},E=function(a,b){return A[a+b*e.tw]},F={};t.addEventListener("click",function(a){var b=$("#canvas").offset(),c=b.top,d=b.left,e=a.pageX-d,f=a.pageY-c;F.x=e,F.y=f;var g=4;console.log("coords x: "+F.x+" coords y:"+F.y);for(var h=0;h<y.length;h++)F.y>y[h].clickY&&F.y<y[h].clickY+y[h].clickHeight&&F.x>y[h].clickX&&F.x<y[h].clickX+y[h].clickWidth?($("#"+y[h].id).fadeIn("slow"),y[h].clicked=!0,y[g].clicked=!1,g=h):($("#"+y[h].id).fadeOut("slow"),y[h].clicked=!1)});var S,Q=0,R=0,T=a(),U=new FPSMeter({decimals:0,graph:!0,theme:"dark",left:"5px"});document.addEventListener("keydown",function(a){return G(a,a.keyCode,!0)},!1),document.addEventListener("keyup",function(a){return G(a,a.keyCode,!1)},!1),c("taylorMap.json",function(a){O(JSON.parse(a.responseText)),V()})}();